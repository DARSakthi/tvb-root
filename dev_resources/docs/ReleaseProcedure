
TVB RELEASE PROCEDURE

When creating a new TVB set of release packages you should:

	- update version number in: framework_tvb/tvb/config/settings.py BASE_VERSION
        
    - in case DB changes happened:
        * increment in scientific_library/tvb/basic/config/settings.py DB_CURRENT_VERSION
        * create a new DB update script in: framework_tvb/tvb/core/entities/model/db_update_scripts/
    - in case File Storage changes drastically:
        * increment in scientific_library/tvb/basic/config/settings.py DATA_VERSION
        * create the next update script in: framework_tvb/tvb/core/entities/file/file_update_scripts/
    - in case something changed in the code, which requires an update script:
        * create a new update script, with svn revision number in: framework_tvb/tvb/core/code_versions/code_update_scripts/
    - in case a Project structure changes :
        * increment in scientific_library/tvb/basic/config/settings.py PROJECT_VERSION
        * create a new project update script, with the new project version-number in: framework_tvb/tvb/core/project_versions/project_update_scripts/
            
    - refresh class diagrams:
    	* go in tvb_documentation/sim_doc and execute sh class_diagrams.sh
    	  	This will update images under tvb/simulator/doc/img. 
    	  	Commit the *.vsg that are used in the *.rst files on SVN.
    	* go in tvb_documentation/sim_doc and execute python generate_model_phase_plane_images.py
    		This will generate images used into Simulator documentation. PLEASE commit the used ones
    		on SVN, so they will be included in the final distribution.
    		To check, for missing images you can try to generate PDF for tvb.simulator.rst (with rst2pdf) and look for missing image errors.
    - run benchmarks for the new release:
        * run tvb.interfaces.command.benchmark.py and copy the resulted text from the console
        * manually create a file tvb_x.y.rst under tvb_documentation/doc_site/benchmarks
        * copy the output from console into this RST file and add headers where needed
        * edit tvb_documentation/doc_site/benchmarks/top_benchmarks.rst to point towards the new file in toctree
        * add the new x_label and values and run tvb_documentation/doc_site/benchmarks/generate_benchmark_img.py

    - check that all README files and manuals are still valid

    - fill new RELEASE_NOTES:
    	* if the release is an internal release add description only in ZWEI
    	* if the release is an official one, update also [tvb-root]/tvb_documentation/RELEASE_NOTES

    - run TVB unit tests (cd tvb_bin sh run_tests.sh) to make sure that everything is correct.
    - generate distribution packages with http://hudson.codemart.ro/ 
        * when the release is public, copy the distribution files on [tvb-live-server]:/opt/tvb-public-releases/[version]
    - http://www.thevirtualbrain.org/tvb/zwei/cms#
        admin/admintvb23
        Upload new ZIP with distributions under "Document" entity
        Create new entity TVB-Release with references towards the ZIP documents uploaded at the previous step.
    - TVB Documentation Site needs to be updated separately, by copying from Hudson the latest ZIP
        https://hudson.codemart.ro/hudson/view/TVB/job/TVB%20-%20Documentation%20Site/
        scp -i [] -P 2222 tvb-documentation-site.zip root@req.thevirtualbrain.org:/root/
        Unzip and copy at location /opt/tvb-documentation-site
        Check at http://docs.thevirtualbrain.com/

    - connecting to the live server:
            scp -i [] -P 2222 TVB_Linux_[x.y.z].zip root@req.thevirtualbrain.org:/home/tvb
	    	ssh -i [authorized-private-key-path] -p *** root@req.thevirtualbrain.org
	    	su tvb
	    	cd ~/TVB_Distribution/bin
	    	sh tvb_start.sh
	    	# check http://www.thevirtualbrain.org/demo

	    	# Update Zwei Site
	    	cd /opt/apache-tomcat/bin
	    	sh shutdown.sh
	    	rm -R rm /opt/apache-tomcat/webapps/tvb/
	    	rm /opt/apache-tomcat/webapps/tvb.war
	    	cp [new WAR] /opt/apache-tomcat/tomcat/webapps/tvb.war
	    	cd cd /opt/apache-tomcat/bin
	    	sh startup.sh
	    	# you should not remove /opt/apache-tomcat/.tvb folder, because in there we keep the DB where registered users are placed.

    - update Git repositories (dev/HowToGIT)
      Create release tag on Git also.
       
    - let the Force be with Us!
    
    
     
 