<py:def function="generateFramePSE(dataTypeGroupGID, available_metrics)" xmlns:py="http://genshi.edgewall.org/"
        xmlns:xi="http://www.w3.org/2001/XInclude">
    <script type="text/javascript" src="/static/js/d3.v3.js"></script>
    <script type="text/javascript" src="/static/js/alternateDatastructure.js"></script>
    <script type="text/javascript" src="/static/flot/jquery.flot.js"></script>
    <script type="text/javascript" src="/static/flot/jquery.flot.symbol.js"></script>
    <script type="text/javascript" src="/static/coloring/colorSchemeComponent.js"></script>

    <!--! Controls for changing metrics -->
    <ul class="toolbar-inline burst-pse-metrics">
        <li>
		<label for="color_metric_select">Color metric</label>
		<select id="color_metric_select">
			<option value="None">None</option>
            <py:for each="metric in available_metrics">
                <py:if test="metric==color_metric">
                    <option value="$metric" selected="selected">$metric</option>
                </py:if>
                <py:if test="metric!=color_metric">
                    <option value="$metric">$metric</option>
                </py:if>
            </py:for>
		</select>
        </li>

        <li>
		<label for="size_metric_select">Size metric</label>
		<select id="size_metric_select">
			<option value="None">None</option>
            <py:for each="metric in available_metrics">
                <py:if test="metric==size_metric">
                    <option value="$metric" selected="selected">$metric</option>
                </py:if>
                <py:if test="metric!=size_metric">
                    <option value="$metric">$metric</option>
                </py:if>
            </py:for>
		</select>
        </li>

        <li>
		<a href="#" onclick="PSE_mainDraw('main_div_pse', '${pse_back_page}')" title="Refresh..." class="action action-refresh">Refresh</a>
        </li>
        <li>
            <button id="Explore" class="action action-analyze">Explore</button>
        </li>
        <li>
            <button id="Filter" class="action action-edit">Filter</button>
        </li>
        <li>
            <button id="Contour" class="action action-edit">Contour</button>
        </li>
    </ul>

    <!--! Controls for displaying MAX / MIN values -->
    <ul class="toolbar-inline burst-pse-colors">
        <li>
            <label>
                <mark>Minimum color metric</mark>
                <span id="minColorLabel"></span> </label>
        </li>
        <li>
            <label>
                <mark>Maximum color metric</mark>
                <span id="maxColorLabel"></span> </label>
        </li>
        <li>
            <label>
                <mark>Minimum shape metric</mark>
                <span id="minShapeLabel"></span> </label>
        </li>
        <li>
            <label>
                <mark>Maximum shape metric</mark>
                <span id="maxShapeLabel"></span> </label>
        </li>
        <li>
            <label class="pse-graph-title">
                <mark>axis Y - axis X</mark>
                $title_y - $title_x</label>
        </li>
    </ul>

    <!--! this is what will become visible upon selecting an canvas area for exploration -->
    <div id="ExploreToolTip" style="display: none;">
        <p>The X Range is</p>
        <p id="xRange"></p>
        <p>The Y Range is</p>
        <p id="yRange"></p>
    </div>
    <div class="tooltip"></div>
    <div id="FilterDiv" style="display: none;">
        <ul class="toolbar-inline" id="filterTools">
            <li>
                <select name="Storing Selections for Filter" id="filterSelect0" class="filterSelectBar">
                </select>
                <input type="text" id="overlayNameInput0"/>
                <button class="action-store action" title="Save your filter inputs" id="saveButton0">Save</button>

                <br/>
                <label for="threshold">Threshold: </label>
                <input class="thresholdInput" type="text" id="threshold0" value="0.35"/>
                <input type="checkbox" name="notButton" id="Not0"/>Not

                <form>
                    <input type="radio" name="thresholdType" id="Size0" checked="checked"/>Size
                    <input type="radio" name="thresholdType" id="Color0"/>Color <br/>
                </form>

                <button class="action action-plus" id="addFilterOps">Add Options</button>
                <button class="action action-confirm" id="filterGo">Start Filter</button>
            </li>
        </ul>
    </div>

    <div class="tooltip"></div>
    <div id="contourDiv" style="display: none;">
        <ul class="toolbar-inline" id="contourTools">
            <li>
                <select name="Storing Selections for contour" id="contourSelect" class="contourSelectBar">
                </select>
                <input type="text" id="contourNameInput"/>
                <button class="action-store action" title="Save your contour inputs" id="saveContourConfig">Save
                </button>

                <br/>
                <label for="RateOfChange">RateOfChange: </label>
                <input type="text" id="rateOfChangeInput" value="65e-5"/>
                <input type="checkbox" id="notButton"/>Not

                <form>
                    <input type="radio" name="RateOfChangeType" id="Size" checked="checked"/>Size
                    <input type="radio" name="RateOfChangeType" id="Color"/>Color <br/>
                </form>

                <button class="action action-confirm" id="contourGo">Start contour</button>
                <button class="action" id="contourClear">Clear lines</button>

            </li>
        </ul>
    </div>


    <input type="hidden" id="datatype-group-gid" value="$dataTypeGroupGID"/>

    <!--! Here PSE bubles will be displayed.	-->
    <div id="main_div_pse" class="specialviewer">
    </div>

    <py:def function="drawMatrixLegendArea(canvasContainerID)">
        <div class="matrix-legend" id="$canvasContainerID">

            <div class="matrix-legend">
                <table id="table-${canvasContainerID}" class="table-legend-labels">
                    <py:for each='label in range(7)'>
                        <py:if test='label != 0'>
                            <tr height="${str(100/8) + '%'}" style='vertical-align: bottom;'>
                                <td>${label}</td>
                            </tr>
                        </py:if>
                        <py:if test='label == 0'>
                            <tr height="20px">
                                <td>${label}</td>
                            </tr>
                        </py:if>
                    </py:for>
                </table>
            </div>
        </div>
    </py:def>
    ${drawMatrixLegendArea('colorWeightsLegend')}

    <script type="text/javascript">
        var data24, nodeInfo24, collectiveData, collectiveInfo, tmpInfo, legendContainer;

                data24 = [{
                    "data": [[0, 0]],
                    "points": {"radius": 19.1853172894},
                    "coords": {"x": 0.93, "y": 12.33}
                }, {"data": [[0, 1]], "points": {"radius": 22.9928375553}, "coords": {"x": 0.93, "y": 12.83}}, {
                    "data": [[0, 2]],
                    "points": {"radius": 12.7519426598},
                    "coords": {"x": 0.93, "y": 13.33}
                }, {"data": [[0, 3]], "points": {"radius": 18.1498754318}, "coords": {"x": 0.93, "y": 13.83}}, {
                    "data": [[0, 4]],
                    "points": {"radius": 12.2224671709},
                    "coords": {"x": 0.93, "y": 14.33}
                }, {"data": [[0, 5]], "points": {"radius": 16.7006562512}, "coords": {"x": 0.93, "y": 14.83}}, {
                    "data": [[1, 0]],
                    "points": {"radius": 26.095335614},
                    "coords": {"x": 0.98, "y": 12.33}
                }, {"data": [[1, 1]], "points": {"radius": 21.718820915}, "coords": {"x": 0.98, "y": 12.83}}, {
                    "data": [[1, 2]],
                    "points": {"radius": 26.5846321192},
                    "coords": {"x": 0.98, "y": 13.33}
                }, {"data": [[1, 3]], "points": {"radius": 15.6576946551}, "coords": {"x": 0.98, "y": 13.83}}, {
                    "data": [[1, 4]],
                    "points": {"radius": 16.0924128895},
                    "coords": {"x": 0.98, "y": 14.33}
                }, {"data": [[1, 5]], "points": {"radius": 10}, "coords": {"x": 0.98, "y": 14.83}}, {
                    "data": [[2, 0]],
                    "points": {"radius": 12.862484061},
                    "coords": {"x": 1.03, "y": 12.33}
                }, {"data": [[2, 1]], "points": {"radius": 23.2339264002}, "coords": {"x": 1.03, "y": 12.83}}, {
                    "data": [[2, 2]],
                    "points": {"radius": 31.8010742281},
                    "coords": {"x": 1.03, "y": 13.33}
                }, {"data": [[2, 3]], "points": {"radius": 30.8209462332}, "coords": {"x": 1.03, "y": 13.83}}, {
                    "data": [[2, 4]],
                    "points": {"radius": 27.0538952451},
                    "coords": {"x": 1.03, "y": 14.33}
                }, {"data": [[2, 5]], "points": {"radius": 18.3147344831}, "coords": {"x": 1.03, "y": 14.83}}, {
                    "data": [[3, 0]],
                    "points": {"radius": 19.1483833282},
                    "coords": {"x": 1.08, "y": 12.33}
                }, {"data": [[3, 1]], "points": {"radius": 25.2752743433}, "coords": {"x": 1.08, "y": 12.83}}, {
                    "data": [[3, 2]],
                    "points": {"radius": 20.4643681626},
                    "coords": {"x": 1.08, "y": 13.33}
                }, {"data": [[3, 3]], "points": {"radius": 23.1271435287}, "coords": {"x": 1.08, "y": 13.83}}, {
                    "data": [[3, 4]],
                    "points": {"radius": 33},
                    "coords": {"x": 1.08, "y": 14.33}
                }, {"data": [[3, 5]], "points": {"radius": 32.3596795}, "coords": {"x": 1.08, "y": 14.83}}];
        nodeInfo24 = {
            "0.93": {
                "12.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "c502990b-4a27-11e6-9924-247703eaf3fc",
                    "color_weight": 6.167353942901428e-7,
                    "tooltip": "Operation id: 8654&lt;br/&gt;Datatype gid: c502990b-4a27-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8654
                },
                "14.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "ba6db748-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 8.647569110101361e-7,
                    "tooltip": "Operation id: 8674&lt;br/&gt;Datatype gid: ba6db748-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8674
                },
                "12.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "f8daa596-4a27-11e6-9924-247703eaf3fc",
                    "color_weight": 7.447212655251371e-7,
                    "tooltip": "Operation id: 8658&lt;br/&gt;Datatype gid: f8daa596-4a27-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8658
                },
                "13.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "55ce554c-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000010909858517403598,
                    "tooltip": "Operation id: 8666&lt;br/&gt;Datatype gid: 55ce554c-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8666
                },
                "14.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "87e21e28-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.000009104168999137599,
                    "tooltip": "Operation id: 8670&lt;br/&gt;Datatype gid: 87e21e28-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8670
                },
                "13.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "29db6338-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000017377564720283131,
                    "tooltip": "Operation id: 8662&lt;br/&gt;Datatype gid: 29db6338-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8662
                }
            },
            "1.08": {
                "12.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "c62847e1-4a27-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000010075882228185133,
                    "tooltip": "Operation id: 8657&lt;br/&gt;Datatype gid: c62847e1-4a27-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8657
                },
                "14.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "c1326dbc-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 9.434361363149573e-7,
                    "tooltip": "Operation id: 8677&lt;br/&gt;Datatype gid: c1326dbc-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8677
                },
                "12.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "fdfdb68a-4a27-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000022344815256355095,
                    "tooltip": "Operation id: 8661&lt;br/&gt;Datatype gid: fdfdb68a-4a27-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8661
                },
                "13.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "5d4eac98-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 5.402144797142424e-7,
                    "tooltip": "Operation id: 8669&lt;br/&gt;Datatype gid: 5d4eac98-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8669
                },
                "14.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "905a2c20-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 4.897308515262516e-7,
                    "tooltip": "Operation id: 8673&lt;br/&gt;Datatype gid: 905a2c20-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8673
                },
                "13.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "2e81583e-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000016668460103600569,
                    "tooltip": "Operation id: 8665&lt;br/&gt;Datatype gid: 2e81583e-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8665
                }
            },
            "1.03": {
                "12.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "c6361c60-4a27-11e6-9924-247703eaf3fc",
                    "color_weight": 0.000005643245336502221,
                    "tooltip": "Operation id: 8656&lt;br/&gt;Datatype gid: c6361c60-4a27-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8656
                },
                "14.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "bf4e40f7-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.000001693903535892038,
                    "tooltip": "Operation id: 8676&lt;br/&gt;Datatype gid: bf4e40f7-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8676
                },
                "12.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "fa9cb58f-4a27-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000016670037423902026,
                    "tooltip": "Operation id: 8660&lt;br/&gt;Datatype gid: fa9cb58f-4a27-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8660
                },
                "13.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "58c8994f-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 6.873580635909723e-7,
                    "tooltip": "Operation id: 8668&lt;br/&gt;Datatype gid: 58c8994f-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8668
                },
                "14.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "8caa9ffd-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000012368886103307727,
                    "tooltip": "Operation id: 8672&lt;br/&gt;Datatype gid: 8caa9ffd-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8672
                },
                "13.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "2b7b7279-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000010490355960533516,
                    "tooltip": "Operation id: 8664&lt;br/&gt;Datatype gid: 2b7b7279-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8664
                }
            },
            "0.98": {
                "12.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "c58f2759-4a27-11e6-9924-247703eaf3fc",
                    "color_weight": 0.000005247728188022526,
                    "tooltip": "Operation id: 8655&lt;br/&gt;Datatype gid: c58f2759-4a27-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8655
                },
                "14.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "bc54b6b6-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 8.087106183352099e-7,
                    "tooltip": "Operation id: 8675&lt;br/&gt;Datatype gid: bc54b6b6-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8675
                },
                "12.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "fa4f5f8e-4a27-11e6-9924-247703eaf3fc",
                    "color_weight": 0.000017745206462907023,
                    "tooltip": "Operation id: 8659&lt;br/&gt;Datatype gid: fa4f5f8e-4a27-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8659
                },
                "13.83": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "5aae9354-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.000001152918836297828,
                    "tooltip": "Operation id: 8667&lt;br/&gt;Datatype gid: 5aae9354-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8667
                },
                "14.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "8c0e2176-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000011904474544003512,
                    "tooltip": "Operation id: 8671&lt;br/&gt;Datatype gid: 8c0e2176-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8671
                },
                "13.33": {
                    "dataType": "TimeSeriesRegion",
                    "Gid": "29fd73e2-4a28-11e6-9924-247703eaf3fc",
                    "color_weight": 0.0000022743320815518227,
                    "tooltip": "Operation id: 8663&lt;br/&gt;Datatype gid: 29fd73e2-4a28-11e6-9924-247703eaf3fc&lt;br/&gt;Datatype type: TimeSeriesRegion&lt;br/&gt;Datatype subject: John Doe&lt;br/&gt;Datatype invalid: False",
                    "operationId": 8663
                }
            }
        };


        //todo take this line out when not interested in normalized data24 radii
        for (var ob of data24) {
            ob.points.radius = ob.points.radius / 4;
        }
        collectiveData = mergeResults($.parseJSON('$series_array'), data24); //todo ask lia on wed how we would permanently merge these results because code that facilitates the merge doesn't do a good job of updating
        tmpInfo = $.parseJSON('$d3_data');
        collectiveInfo = mergeNodeInfo(tmpInfo, nodeInfo24); //difference in merges here is it is a mutable object change, so '$d3_data' still be passed below.
        $(document).ready(function () {
            PSEDiscreteInitialize('$labels_x', '$labels_y', collectiveData, '$data', '$pse_back_page',
                    $has_started_ops, '$min_color', '$max_color', '$min_shape_size', '$max_shape_size', collectiveInfo);
            legendContainer = d3.select("#colorWeightsLegend");
            var legendHeight = d3.select("#table-colorWeightsLegend").node().getBoundingClientRect().height;
            var tableContainer = d3.select("#table-colorWeightsLegend");
            ColSch_updateLegendColors(legendContainer.node(), legendHeight);
            ColSch_updateLegendLabels(tableContainer.node(), '$min_color', '$max_color', legendHeight);
            window.onresize = function () {
                redrawPlot('main_div_pse');
            };
        });
    </script>

</py:def>


