<py:def function="generateFramePSE(dataTypeGroupGID, available_metrics)" xmlns:py="http://genshi.edgewall.org/"
        xmlns:xi="http://www.w3.org/2001/XInclude">
    <script type="text/javascript" src="/static/js/d3.v3.js"></script>
    <script type="text/javascript" src="/static/js/alternateDatastructure.js"></script>
    <script type="text/javascript" src="/static/flot/jquery.flot.js"></script>
    <script type="text/javascript" src="/static/flot/jquery.flot.symbol.js"></script>
    <script type="text/javascript" src="/static/coloring/colorSchemeComponent.js"></script>

    <!--! Controls for changing metrics -->
    <ul class="toolbar-inline burst-pse-metrics">
        <li>
		<label for="color_metric_select">Color metric</label>
		<select id="color_metric_select">
			<option value="None">None</option>
            <py:for each="metric in available_metrics">
                <py:if test="metric==color_metric">
                    <option value="$metric" selected="selected">$metric</option>
                </py:if>
                <py:if test="metric!=color_metric">
                    <option value="$metric">$metric</option>
                </py:if>
            </py:for>
		</select>
        </li>

        <li>
		<label for="size_metric_select">Size metric</label>
		<select id="size_metric_select">
			<option value="None">None</option>
            <py:for each="metric in available_metrics">
                <py:if test="metric==size_metric">
                    <option value="$metric" selected="selected">$metric</option>
                </py:if>
                <py:if test="metric!=size_metric">
                    <option value="$metric">$metric</option>
                </py:if>
            </py:for>
		</select>
        </li>

        <li>
		<a href="#" onclick="PSE_mainDraw('main_div_pse', '${pse_back_page}')" title="Refresh..." class="action action-refresh">Refresh</a>
        </li>
        <li>
            <button id="Explore" class="action action-analyze">Explore</button>
        </li>
        <li>
            <button id="Filter" class="action action-edit">Filter</button>
        </li>
        <li>
            <button id="Contour" class="action action-edit">Contour</button>
        </li>
    </ul>

    <!--! Controls for displaying MAX / MIN values -->
    <ul class="toolbar-inline burst-pse-colors">
        <li>
            <label>
                <mark>Minimum color metric</mark>
                <span id="minColorLabel"></span> </label>
        </li>
        <li>
            <label>
                <mark>Maximum color metric</mark>
                <span id="maxColorLabel"></span> </label>
        </li>
        <li>
            <label>
                <mark>Minimum shape metric</mark>
                <span id="minShapeLabel"></span> </label>
        </li>
        <li>
            <label>
                <mark>Maximum shape metric</mark>
                <span id="maxShapeLabel"></span> </label>
        </li>
        <li>
            <label class="pse-graph-title">
                <mark>axis Y - axis X</mark>
                $title_y - $title_x</label>
        </li>
    </ul>

    <!--! this is what will become visible upon selecting an canvas area for exploration -->
    <div id="ExploreToolTip" style="display: none;">
        <p>The X Range is</p>
        <p id="xRange"></p>
        <p>The Y Range is</p>
        <p id="yRange"></p>
    </div>
    <div class="tooltip"></div>
    <div id="FilterDiv" style="display: none;">
        <ul class="toolbar-inline" id="filterTools">
            <li>
                <select name="Storing Selections for Filter" id="filterSelect0" class="filterSelectBar">
                </select>
                <input type="text" id="overlayNameInput0"/>
                <button class="action-store action" title="Save your filter inputs" id="saveButton0">Save</button>

                <br/>
                <label for="threshold">Threshold: </label>
                <input class="thresholdInput" type="text" id="threshold0" value="0.35"/>
                <input type="checkbox" name="notButton" id="Not0"/>Not

                <form>
                    <input type="radio" name="thresholdType" id="Size0" checked="checked"/>Size
                    <input type="radio" name="thresholdType" id="Color0"/>Color <br/>
                </form>

                <button class="action action-plus" id="addFilterOps">Add Options</button>
                <button class="action action-confirm" id="filterGo">Start Filter</button>
            </li>
        </ul>
    </div>

    <div class="tooltip"></div>
    <div id="contourDiv" style="display: none;">
        <ul class="toolbar-inline" id="contourTools">
            <li>
                <select name="Storing Selections for contour" id="contourSelect" class="contourSelectBar">
                </select>
                <input type="text" id="contourNameInput"/>
                <button class="action-store action" title="Save your contour inputs" id="saveContourConfig">Save
                </button>

                <br/>
                <label for="rateOfChangeInput">RateOfChange: </label>
                <input type="text" id="rateOfChangeInput" value="65e-5"/>
                <input type="checkbox" id="notButton"/>Not

                <form>
                    <input type="radio" name="RateOfChangeType" id="Size" checked="checked"/>
                    <label for="Size">Size (min --> max)</label>
                    <input type="radio" name="RateOfChangeType" id="Color"/>
                    <label for="Color">Color (min --> max) </label><br/>
                </form>

                <button class="action action-confirm" id="contourGo">Start contour</button>
                <button class="action" id="contourClear">Clear lines</button>

            </li>
        </ul>
    </div>

    <div class="tooltip"></div>
    <div id="exploreDiv" style="display: none;">
        <ul class="toolbar-inline" id="exploreTools">
            <fieldset>
                <dl>
                    <dt>
                        <label>Parameter A range</label>
                    </dt>
                    <dd>
                        <input type="number" name="lowerBoundParA" id="lowA"/>
                        <input type="number" name="upperBoundParA" id="upperA"/>
                    </dd>
                </dl>
                <dl>
                    <dt>
                        <label>Parameter A Step Slider</label>
                    </dt>
                    <dd>
                        <div class="sliderStepDiv">
                            <div id="AStepSlider"
                                 title="Slider to adjust the step increment of the next exploration"></div>
                        </div>
                    </dd>
                </dl>
                <dl>
                    <dt>
                        <label>Parameter B range</label>
                    </dt>
                    <dd>
                        <input type="number" name="lowerBoundParB" id="lowB"/>
                        <input type="number" name="upperBoundParB" id="upperB"/>
                    </dd>
                </dl>
                <dl>
                    <dt>
                        <label>Parameter B Step Slider</label>
                    </dt>
                    <dd>
                        <div class="sliderStepDiv">
                            <div id="BStepSlider"
                                 title="Slider to adjust the step increment of the next exploration"></div>
                        </div>
                    </dd>
                </dl>

            </fieldset>
        </ul>

        <script type="text/javascript">
            $(document).ready(function () {
                var elemSliderA = $('#AStepSlider');
                elemSliderA.slider({
                    min: 0, max: 1, step: .0001, value: 0,
                    change: function (event, ui) {
                        console.log('the slider is now at ' + ui.value)
                        console.log('something to do with the event is ' + event)
                    }
                });
                var elemSliderB = $('#BStepSlider');
                elemSliderB.slider({
                    min: 0, max: 1, step: .0001, value: 0,
                    change: function (event, ui) {
                        console.log('the slider is now at ' + ui.value)
                        console.log('something to do with the event is ' + event)
                    }
                })
            })
        </script>
    </div>


    <input type="hidden" id="datatype-group-gid" value="$dataTypeGroupGID"/>

    <!--! Here PSE bubles will be displayed.	-->
    <div id="main_div_pse" class="specialviewer">
    </div>

    <py:def function="drawMatrixLegendArea(canvasContainerID)">
        <div class="matrix-legend" id="$canvasContainerID"></div>

        <div class="matrix-legend">
            <table id="table-${canvasContainerID}" class="table-legend-labels">
                <py:for each='label in range(7)'>
                    <py:if test='label != 0'>
                        <tr height="${str(100/8) + '%'}" style='vertical-align: bottom;'>
                            <td>${label}</td>
                        </tr>
                    </py:if>
                    <py:if test='label == 0'>
                        <tr height="20px">
                            <td>${label}</td>
                        </tr>
                    </py:if>
                </py:for>
            </table>
        </div>

    </py:def>
    ${drawMatrixLegendArea('colorWeightsLegend')}

    <script type="text/javascript">

        $(document).ready(function () {
            // the line below this is just to keep certain things in this genshi from being run multiple times
            PSEDiscreteInitialize('$labels_x', '$labels_y', '$series_array', '$data', '$pse_back_page',
                    $has_started_ops, '$min_color', '$max_color', '$min_shape_size', '$max_shape_size', '$d3_data');

            window.onresize = function () {
                redrawPlot('main_div_pse');
            };
        });
    </script>

</py:def>


